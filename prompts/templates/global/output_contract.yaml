version: "1.0"

extraction_output_contract:
  type: "object"

  required:
    - field
    - value
    - text_source
    - synonyms_found
    - justification

  properties:
    field:
      type: "string"
      description: "Field name"

    value:
      description: "Extracted value (field-dependent structure)"
      oneOf:
        - type: "object"
        - type: "null"

    text_source:
      description: "Minimal evidence supporting the extraction (can be an object or a list of objects)"
      oneOf:
        - type: "object"
          required:
            - text
            - chunk_id
            - chunk_page
            - chunk_document
          properties:
            text:
              type: "string"
            chunk_id:
              type: "string"
            chunk_page:
              type: "array"
              items:
                type: "integer"
            chunk_document:
              type: "string"
        - type: "array"
          items:
            type: "object"
            required:
              - text
              - chunk_id
              - chunk_page
              - chunk_document
            properties:
              text:
                type: "string"
              chunk_id:
                type: "string"
              chunk_page:
                type: "array"
                items:
                  type: "integer"
              chunk_document:
                type: "string"

    synonyms_found:
      description: "List of equivalent terms (str) found"
      oneOf:
        - type: "array"
          items:
            type: "string"
        - type: "string"

    justification:
      type: "string"
      description: "Detailed justification of the extracted values in relation to the source text"


audit_output_contract:
  type: "object"
  description: "Validation output for auditing extracted financial fields from annual reports"

  required:
    - field
    - is_valid
    - confidence
    - justification

  properties:
    field:
      type: "string"
      description: "Audited field identifier/name"

    is_valid:
      type: "boolean"
      description: "Whether the extraction is valid given the operational definition and cited evidence"

    confidence:
      type: "number"
      minimum: 0
      maximum: 1
      description: "Auditor confidence score between 0 and 1"

    justification:
      type: "string"
      description: "Brief, specific justification referencing alignment and traceability checks"


condition_output_contract:
  type: "object"
  description: "Compliance evaluation output for validating premises/conditions using provided company fields only"

  required:
    - condition
    - answer
    - explanation

  properties:
    condition:
      type: "string"
      description: "Name of the evaluated premise/condition"

    answer:
      description: "Selected compliance level and its numeric score (varies by scoring_levels)"
      oneOf:
        # scoring_levels == 5
        - type: "object"
          required: ["label", "value"]
          properties:
            label:
              type: "string"
              enum: ["Very High", "High", "Medium", "Low", "Very Low"]
            value:
              type: "number"
              enum: [1.0, 3.0, 5.0, 7.5, 10.0]
          allOf:
            - if: { properties: { label: { const: "Very High" } }, required: ["label"] }
              then: { properties: { value: { const: 1.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "High" } }, required: ["label"] }
              then: { properties: { value: { const: 3.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "Medium" } }, required: ["label"] }
              then: { properties: { value: { const: 5.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "Low" } }, required: ["label"] }
              then: { properties: { value: { const: 7.5 } }, required: ["value"] }
            - if: { properties: { label: { const: "Very Low" } }, required: ["label"] }
              then: { properties: { value: { const: 10.0 } }, required: ["value"] }

        # scoring_levels == 3
        - type: "object"
          required: ["label", "value"]
          properties:
            label:
              type: "string"
              enum: ["High", "Medium", "Low"]
            value:
              type: "number"
              enum: [1.0, 5.0, 10.0]
          allOf:
            - if: { properties: { label: { const: "High" } }, required: ["label"] }
              then: { properties: { value: { const: 1.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "Medium" } }, required: ["label"] }
              then: { properties: { value: { const: 5.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "Low" } }, required: ["label"] }
              then: { properties: { value: { const: 10.0 } }, required: ["value"] }

        # scoring_levels == 2
        - type: "object"
          required: ["label", "value"]
          properties:
            label:
              type: "string"
              enum: ["High", "Low"]
            value:
              type: "number"
              enum: [1.0, 10.0]
          allOf:
            - if: { properties: { label: { const: "High" } }, required: ["label"] }
              then: { properties: { value: { const: 1.0 } }, required: ["value"] }
            - if: { properties: { label: { const: "Low" } }, required: ["label"] }
              then: { properties: { value: { const: 10.0 } }, required: ["value"] }

    explanation:
      type: "string"
      description: "Justification based strictly on provided fields (max 500 characters)"
      maxLength: 500
